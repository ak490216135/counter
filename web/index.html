<!DOCTYPE html>
<html>
<head>
	<meta charset="UTF-8">
	<title>index</title>
</head>
<body>
	<p>
		index
	</p>
	<p>
		<span>count:</span>
		<span id="countNum">0</span>
		<button onclick="getCount()">GET</button>
	</p>
	<p>
		<button onclick="addCount()">ADD</button>
		<button onclick="addCount10()">ADD 10</button>
	</p>

	<script src="https://cdn.jsdelivr.net/npm/web3@latest/dist/web3.min.js"></script>
	<script>
		var web3 = new Web3()
		// let server = "http://127.0.0.1:7545"
		let server = ethereum
		web3.setProvider(server)
		ethereum.enable()

		// 合约相关
		let account = ethereum.selectedAddress // 账户
		let contractAddress = "0xbf1D44daa22a058e87BAEA2C75D367a87B4277Cc" // 合约地址
		let contractText = ""
		let abi = '[{"inputs":[],"name":"add","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[],"name":"add10","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[],"stateMutability":"nonpayable","type":"constructor"},{"inputs":[],"name":"get","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"num","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"owner","outputs":[{"internalType":"address","name":"","type":"address"}],"stateMutability":"view","type":"function"}]'
		abi = JSON.parse(abi)
		let byteCode = ""

		let counterContract = new web3.eth.Contract(
			abi,
			contractAddress
		)

		// 
		function connectMeta(){
			ethereum.enable()
		}

		// 获取计数
		function getCount(){
			counterContract.methods.get().call(
				{},
				(err, res) => {
					console.log(res)
					window.document.getElementById("countNum").innerText = res
				}
			)
		}
		// 添加计数
		function addCount(){
			let options = {
				from: account,
				gasPrice: '20000000000',
				gas: 6721975,
				value : 0
			}
			counterContract.methods.add().send(options).then((res)=>{
				console.log(res)
			})
		}
		// 添加计数 10
		function addCount10(){
			let options = {
				from: account,
				gasPrice: '20000000000',
				gas: 6721975,
				value : 0
			}
			counterContract.methods.add10().send(options).then((res)=>{
				console.log(res)
			})
		}
		
	</script>
</body>
</html>